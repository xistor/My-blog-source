---
title: "Linux/Unix系统编程手册-笔记5.进程"
date: 2020-07-16T14:01:00+08:00
tags: ["Linux"]
categories: ["Linux系统编程手册阅读"]
---

### 进程和程序
进程是一个运行中的程序实例，一个程序中包含了如何构建一个进程的信息，这些信息包括：
- 二进制格式识别信息：每个程序都包含了元信息来描述可执行文件的格式，内核依靠这个来解释文件中的剩余信息。
历史上广泛使用的有a.out(assembler output)和之后的COFF(Common Object File Format),现在大多使用Executable and Linking Format (ELF)。
- 机器指令
- 程序入口地址：标识程序开始执行的指令的位置
- data: 程序中用于初始化变量的值或者程序用到的常量
- Symbol and relocation tables:描述函数或变量名称以及在程序中的位置，用于debug或dynamic linking
- 共享库和动态链接信息：程序文件中包含字段列出了程序运行时需要的所有共享库，以及用来载入lib的动态链接器的路径名
- 其他信息

从系统角度来看，一个进程包括一段用户空间内存，里面有程序的代码和用到的变量等等，以及一段内核空间内存，里面维护了程序状态等信息（PID, 虚拟内存表，open file descriptors, 信号传递和处理的相关信息， 进程资源使用及限制，当前工作目录，以及其他信息）。


### 进程ID和父进程ID

```cpp
#include <unistd.h>
pid_t getpid(void); /*获取进程ID*/

pid_t getppid(void); /*获取父进程ID*/    
```

Linux 内核限制PID小于等于32767,当分配的PID到达了32767，会从300开始再次分配，因为较小的PID多数为系统进程或守护进程。Linux 2.6之后可以通过/proc/sys/kernel/pid_max来调整，在64位系统上可以到2^22。

如果一个进程的父进程终止，它会变为孤儿进程，会被init“领养”，getppid()会返回init的进程号，也就是1。

### 进程的内存布局

- 代码段(text):包含了程序的机器码指令，代码段只读，不同进程可以共享代码段。
-  initialized data segment： 保存显式初始化过的全局变量和静态变量。这些变量的值是在程序载入内存时从可执行文件内读取对的。
- uninitialized data segment： 保存未显式初始化过的全局变量和静态变量。在程序启动之前，这部分内存会被初始化为0。也称BSS段。此段被和已经初始化的变量分开的原因是，当程序保存在硬盘上的时候是不需要保存这些没初始化的变量的，但进程跑起来的时候需要，而且部分空间是在程序载入内存的时候才会分配。
- 栈区(stack): 存储局部变量，参数，返回值。
- 堆(heap): 运行时动态分配的内存。
